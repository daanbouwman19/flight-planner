<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs">
  <Package Name="Flight Planner" 
           Version="$(var.ProductVersion)" 
           Manufacturer="Daan Bouwman" 
           UpgradeCode="{4B3EFA40-184E-4598-BCAD-0D39D42ACD96}"
           ProductCode="{F8A9C2D1-6B5E-4A3F-9C7D-2E8F5B1A9C3E}">

    <MajorUpgrade DowngradeErrorMessage="A newer version of Flight Planner is already installed."
                  AllowSameVersionUpgrades="yes"
                  Schedule="afterInstallInitialize" />

    <Media Id="1" Cabinet="Product.cab" EmbedCab="yes" />

    <Icon Id="AppIcon" SourceFile="assets\icons\app.ico" />
    
    <Property Id="ARPPRODUCTICON" Value="AppIcon" />
    <Property Id="ARPHELPLINK" Value="https://github.com/daanbouwman19/flight-planner" />
    
    <!-- Ensure proper upgrade behavior -->
    <Property Id="REINSTALLMODE" Value="amus" />
    <Property Id="REINSTALL" Value="ALL" />

    <StandardDirectory Id="LocalAppDataFolder">
      <Directory Id="INSTALLFOLDER" Name="Flight Planner" />
    </StandardDirectory>

    <StandardDirectory Id="ProgramMenuFolder">
      <Directory Id="ApplicationProgramsFolder" Name="Flight Planner"/>
    </StandardDirectory>

    <Component Id="MainExecutable" Directory="INSTALLFOLDER">
      <File Source="target\release\flight_planner.exe" />
    </Component>

    <Component Id="ApplicationData" Directory="INSTALLFOLDER">
      <File Source="aircrafts.csv" />
    </Component>

    <Component Id="ApplicationShortcuts" Directory="ApplicationProgramsFolder">
      <Shortcut Id="ApplicationStartMenuShortcut"
                Name="Flight Planner"
                Target="[INSTALLFOLDER]flight_planner.exe"
                WorkingDirectory="INSTALLFOLDER"
                Icon="AppIcon"/>
      <RemoveFolder Id="ApplicationProgramsFolder" On="uninstall"/>
      <RegistryValue Root="HKCU" 
                     Key="Software\Daan Bouwman\Flight Planner" 
                     Name="InstallPath" 
                     Type="string" 
                     Value="[INSTALLFOLDER]" 
                     KeyPath="true"/>
    </Component>

    <Feature Id="MainApplication" Title="Flight Planner">
      <ComponentRef Id="MainExecutable" />
      <ComponentRef Id="ApplicationData" />
      <ComponentRef Id="ApplicationShortcuts" />
    </Feature>

  </Package>
</Wix>